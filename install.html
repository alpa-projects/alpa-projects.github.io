<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Install Alpa &mdash; Alpa 0.0.1 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/sg_gallery.css" type="text/css" />
      <link rel="stylesheet" href="_static/sg_gallery-binder.css" type="text/css" />
      <link rel="stylesheet" href="_static/sg_gallery-dataframe.css" type="text/css" />
      <link rel="stylesheet" href="_static/sg_gallery-rendered-html.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Alpa Quickstart" href="tutorials/quickstart.html" />
    <link rel="prev" title="Alpa Documentation" href="index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> Alpa
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Install Alpa</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#requirements">Requirements</a></li>
<li class="toctree-l2"><a class="reference internal" href="#prerequisites">Prerequisites</a></li>
<li class="toctree-l2"><a class="reference internal" href="#install-from-python-wheels">Install from Python Wheels</a></li>
<li class="toctree-l2"><a class="reference internal" href="#install-from-source">Install from Source</a></li>
<li class="toctree-l2"><a class="reference internal" href="#check-installation">Check Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#troubleshooting">Troubleshooting</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#using-alpa-on-slurm">Using Alpa on Slurm</a></li>
<li class="toctree-l3"><a class="reference internal" href="#jaxlib-jax-flax-version-problems">Jaxlib, Jax, Flax Version Problems</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="tutorials/quickstart.html">Alpa Quickstart</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="tutorials/pipeshard_parallelism.html">Distributed Training with Both Shard and Pipeline Parallelism</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorials/alpa_vs_pmap.html">Differences between alpa.parallelize and jax.pmap</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Architecture</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="architecture/overview.html">Design and Architecture</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="developer/developer_guide.html">Developer Guide</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Alpa</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Install Alpa</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/install.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="install-alpa">
<h1>Install Alpa<a class="headerlink" href="#install-alpa" title="Permalink to this headline"></a></h1>
<div class="section" id="requirements">
<h2>Requirements<a class="headerlink" href="#requirements" title="Permalink to this headline"></a></h2>
<ul class="simple">
<li><p>CUDA &gt;= 11.1</p></li>
<li><p>cuDNN &gt;= 8.0.5</p></li>
<li><p>python &gt;= 3.7</p></li>
</ul>
</div>
<div class="section" id="prerequisites">
<h2>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this headline"></a></h2>
<p>Regardless of installing from wheels or from source, we need to install a few prerequisite packages:</p>
<ol class="arabic simple">
<li><p>CUDA toolkit:</p></li>
</ol>
<blockquote>
<div><p>Follow the official guides to install <a class="reference external" href="https://developer.nvidia.com/cuda-toolkit">CUDA</a> and <a class="reference external" href="https://developer.nvidia.com/cudnn">cuDNN</a>.</p>
</div></blockquote>
<ol class="arabic" start="2">
<li><p>Install the ILP solver used by Alpa:</p>
<blockquote>
<div><p>If you have sudo permission, use</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo apt install coinor-cbc
</pre></div>
</div>
</div></blockquote>
<p>Otherwise, please try to install via <a class="reference external" href="https://projects.coin-or.org/Cbc#DownloadandInstall">binary</a> or <a class="reference external" href="https://anaconda.org/conda-forge/coincbc">conda</a>.</p>
</div></blockquote>
</li>
<li><p>Install cupy:</p></li>
</ol>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Use your own CUDA version. Here cuda-cuda114 means cuda 11.4</span>
pip3 install cupy-cuda114
</pre></div>
</div>
<p>Then, check whether your system already has NCCL installed.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python3 -c <span class="s2">&quot;from cupy.cuda import nccl&quot;</span>
</pre></div>
</div>
<p>If it prints nothing, then NCCL has already been installed.
Otherwise, follow the printed instructions to install NCCL.</p>
</div></blockquote>
</div>
<div class="section" id="install-from-python-wheels">
<span id="install-from-wheels"></span><h2>Install from Python Wheels<a class="headerlink" href="#install-from-python-wheels" title="Permalink to this headline"></a></h2>
<p>Alpa provides wheels for the following CUDA (cuDNN) and Python versions:</p>
<ul class="simple">
<li><p>CUDA (cuDNN): 11.1 (8.0.5), 11.2 (8.1.0), 11.3 (8.2.0)</p></li>
<li><p>Python: 3.7, 3.8, 3.9</p></li>
</ul>
<p>If you need to use other CUDA, cuDNN, or Python versions, please follow the next section to <a class="reference internal" href="#install-from-source"><span class="std std-ref">install from source</span></a>.</p>
<ol class="arabic simple">
<li><p>To install from wheels, first install Alpa:</p></li>
</ol>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip3 install --upgrade pip
pip3 install alpa
</pre></div>
</div>
</div></blockquote>
<ol class="arabic simple" start="2">
<li><p>Then install the Alpa-modified Jaxlib from our <a class="reference external" href="http://169.229.48.123:8080/simple/">self-hosted PyPI server</a>,
and make sure that the jaxlib version corresponds to the version of the existing CUDA and cuDNN installation you want to use.
You can specify a particular CUDA and cuDNN version for jaxlib explicitly via:</p></li>
</ol>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip3 install --trusted-host <span class="m">169</span>.229.48.123 -i http://169.229.48.123:8080/simple/ <span class="nv">jaxlib</span><span class="o">==</span><span class="m">0</span>.3.5+cuda<span class="o">{</span>cuda_version<span class="o">}</span>.cudnn<span class="o">{</span>cudnn_version<span class="o">}</span>
</pre></div>
</div>
<p>For example, to install the wheel compatible with CUDA &gt;= 11.1 and cuDNN &gt;= 8.0.5, use the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip3 install --trusted-host <span class="m">169</span>.229.48.123 -i http://169.229.48.123:8080/simple/ <span class="nv">jaxlib</span><span class="o">==</span><span class="m">0</span>.3.5+cuda111.cudnn805
</pre></div>
</div>
<p>You can see all available wheel versions we provided at our <a class="reference external" href="http://169.229.48.123:8080/simple/jaxlib/">PyPI index</a>.</p>
</div></blockquote>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>As of now, Alpa modified the original jaxlib at the version <code class="docutils literal notranslate"><span class="pre">jaxlib==0.3.5</span></code>. Alpa regularly rebases the official jaxlib repository to catch up with the upstream.
If you need features from newer versions of jaxlib, please open an issue at the <a class="reference external" href="https://github.com/alpa-projects/alpa/issues">Alpa GitHub Issue Page</a>.</p>
</div>
</div>
<div class="section" id="install-from-source">
<span id="id1"></span><h2>Install from Source<a class="headerlink" href="#install-from-source" title="Permalink to this headline"></a></h2>
<ol class="arabic simple">
<li><p>Clone repos</p></li>
</ol>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git clone --recursive git@github.com:alpa-projects/alpa.git
</pre></div>
</div>
</div></blockquote>
<ol class="arabic simple" start="2">
<li><p>Build and install jaxlib</p></li>
</ol>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> alpa/build_jaxlib
python3 build/build.py --enable_cuda --dev_install --tf_path<span class="o">=</span><span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span>/../third_party/tensorflow-alpa
<span class="nb">cd</span> dist

pip3 install -e .
</pre></div>
</div>
</div></blockquote>
<ol class="arabic simple" start="3">
<li><p>Install Alpa</p></li>
</ol>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> alpa
pip3 install -e .<span class="o">[</span>dev<span class="o">]</span>  <span class="c1"># Note that the suffix `[dev]` is required to build custom modules.</span>
</pre></div>
</div>
</div></blockquote>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>All installations are in development mode, so you can modify python code and it will take effect immediately.
To modify c++ code in tensorflow, you only need to run the command below from step 2 to recompile jaxlib:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>python3 build/build.py --enable_cuda --dev_install --tf_path=$(pwd)/../third_party/tensorflow-alpa
</pre></div>
</div>
</div>
</div>
<div class="section" id="check-installation">
<h2>Check Installation<a class="headerlink" href="#check-installation" title="Permalink to this headline"></a></h2>
<p>You can check the installation by running the following test script.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> alpa
ray start --head
python3 tests/test_install.py
</pre></div>
</div>
</div>
<div class="section" id="troubleshooting">
<h2>Troubleshooting<a class="headerlink" href="#troubleshooting" title="Permalink to this headline"></a></h2>
<div class="section" id="using-alpa-on-slurm">
<h3>Using Alpa on Slurm<a class="headerlink" href="#using-alpa-on-slurm" title="Permalink to this headline"></a></h3>
<p>Since Alpa relies on Ray to manage the cluster nodes, Alpa can run on a Slurm cluster as long as Ray can run on it.
If you have trouble running Alpa on a Slurm cluster, we recommend to follow <a class="reference external" href="https://docs.ray.io/en/latest/cluster/slurm.html">this guide</a> to setup Ray on Slurm and make sure simple Ray examples
can run without any problem, then move forward to install and run Alpa in the same environment.</p>
<p>Common issues of running Alpa on Slurm include:</p>
<ul class="simple">
<li><p>The Slurm cluster has installed additional networking proxies, so XLA client connections time out. Example errors can be found in <a class="reference external" href="https://github.com/alpa-projects/alpa/issues/452#issuecomment-1134260817">this thread</a>.
The slurm cluster users might need to check and fix those proxies on their slurm cluster and make sure processes spawned by Alpa can see each other.</p></li>
<li><p>When launching a Slurm job using <code class="docutils literal notranslate"><span class="pre">SRUN</span></code>, the users do not request enough CPU threads or GPU resources for Ray to spawn many actors on Slurm.
The users need to adjust the value for the argument <code class="docutils literal notranslate"><span class="pre">--cpus-per-task</span></code> passed to <code class="docutils literal notranslate"><span class="pre">SRUN</span></code> when launching Alpa. See <a class="reference external" href="https://slurm.schedmd.com/srun.html">Slurm documentation</a> for more information.</p></li>
</ul>
<p>You might also find the discussion under <a class="reference external" href="https://github.com/alpa-projects/alpa/issues/452">Issue #452</a> helpful.</p>
</div>
<div class="section" id="jaxlib-jax-flax-version-problems">
<h3>Jaxlib, Jax, Flax Version Problems<a class="headerlink" href="#jaxlib-jax-flax-version-problems" title="Permalink to this headline"></a></h3>
<p>Alpa is compatible with the following Jaxlib, Jax, and Flax versions:
- Jax==0.3.5
- Flax==0.4.1
- Alpa-modified Jaxlib distributed at <a class="reference external" href="http://169.229.48.123:8080/simple/">self-hosted PyPI</a> or compiled from source.</p>
<p>However, sometimes the users might have installed other versions of Jax-based neural network libraries, such as Flax or Optax in their environment, an incompatible version of
Jaxlib or Jax will be automatically installed by pip, and the following error might appear when importing alpa:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>&gt;&gt;&gt; import alpa
  ......
  RuntimeError: jaxlib version <span class="m">0</span>.3.7 is newer than and incompatible with jax version <span class="m">0</span>.3.5. Please update your jax and/or jaxlib packages
</pre></div>
</div>
<p>Make sure your jax version is 0.3.5, Flax version is 0.4.1 by reinstalling them following:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip3 install <span class="nv">jax</span><span class="o">==</span><span class="m">0</span>.3.5
pip3 install <span class="nv">flax</span><span class="o">==</span><span class="m">0</span>.4.1
</pre></div>
</div>
<p>Make sure you install <strong>Alpa-modified Jaxlib</strong> by either using <a class="reference internal" href="#install-from-wheels"><span class="std std-ref">our prebuilt wheels</span></a> or <a class="reference internal" href="#install-from-source"><span class="std std-ref">Install from Source</span></a>.</p>
</div>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="index.html" class="btn btn-neutral float-left" title="Alpa Documentation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="tutorials/quickstart.html" class="btn btn-neutral float-right" title="Alpa Quickstart" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright .</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>